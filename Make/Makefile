DEBUG_OUTPUT_DIR   = Debug
RELEASE_OUTPUT_DIR = Release
SOURCE_DIR = ../Source

# Engine compilation setup
ENGINE_ROOT = $(SOURCE_DIR)/Engine
ENGINE_SRC  = $(wildcard $(ENGINE_ROOT)/*.cpp $(ENGINE_ROOT)/*/*.cpp $(ENGINE_ROOT)/*/*/*.cpp $(ENGINE_ROOT)/*/*/*/*.cpp $(ENGINE_ROOT)/*/*/*/*/*.cpp $(ENGINE_ROOT)/*/*/*/*/*/*.cpp)
DEBUG_ENGINE_OBJ    = $(subst $(DEBUG_OUTPUT_DIR)!,$(DEBUG_OUTPUT_DIR)/,$(subst /,., $(patsubst $(SOURCE_DIR)/%.cpp, $(DEBUG_OUTPUT_DIR)!%.o, $(ENGINE_SRC))))
RELEASE_ENGINE_OBJ  = $(subst $(RELEASE_OUTPUT_DIR)!,$(RELEASE_OUTPUT_DIR)/,$(subst /,., $(patsubst $(SOURCE_DIR)/%.cpp, $(RELEASE_OUTPUT_DIR)!%.o, $(ENGINE_SRC))))
DEBUG_ENGINE_LIBS   = -lrt
RELEASE_ENGINE_LIBS = -lrt
DEBUG_ENGINE_TARGET   = $(DEBUG_OUTPUT_DIR)/Engine.a
RELEASE_ENGINE_TARGET = $(RELEASE_OUTPUT_DIR)/Engine.a

# Exporter compilation setup
EXPORTER_ROOT = $(SOURCE_DIR)/Exporter
EXPORTER_SRC  = $(wildcard $(EXPORTER_ROOT)/*.cpp)
DEBUG_EXPORTER_LIBS   = -lrt $(DEBUG_ENGINE_TARGET)
RELEASE_EXPORTER_LIBS = -lrt $(RELEASE_ENGINE_TARGET)
DEBUG_EXPORTER_TARGET   = $(DEBUG_OUTPUT_DIR)/Exporter
RELEASE_EXPORTER_TARGET = $(RELEASE_OUTPUT_DIR)/Exporter

# Linux platform compilation setup
LINUX_PLATFORM_ROOT = $(SOURCE_DIR)/Platforms/Linux
LINUX_PLATFORM_SRC  = $(wildcard $(LINUX_PLATFORM_ROOT)/*.cpp $(LINUX_PLATFORM_ROOT)/*/*.cpp $(LINUX_PLATFORM_ROOT)/*/*/*.cpp $(LINUX_PLATFORM_ROOT)/*/*/*/*.cpp $(LINUX_PLATFORM_ROOT)/*/*/*/*/*.cpp $(LINUX_PLATFORM_ROOT)/*/*/*/*/*/*.cpp)
DEBUG_LINUX_PLATFORM_OBJ    = $(subst $(DEBUG_OUTPUT_DIR)!,$(DEBUG_OUTPUT_DIR)/,$(subst /,., $(patsubst $(SOURCE_DIR)/%.cpp, $(DEBUG_OUTPUT_DIR)!%.o, $(LINUX_PLATFORM_SRC))))
RELEASE_LINUX_PLATFORM_OBJ  = $(subst $(RELEASE_OUTPUT_DIR)!,$(RELEASE_OUTPUT_DIR)/,$(subst /,., $(patsubst $(SOURCE_DIR)/%.cpp, $(RELEASE_OUTPUT_DIR)!%.o, $(LINUX_PLATFORM_SRC))))
DEBUG_LINUX_PLATFORM_LIBS   = -lrt
RELEASE_LINUX_PLATFORM_LIBS = -lrt
DEBUG_LINUX_PLATFORM_TARGET   = $(DEBUG_OUTPUT_DIR)/Linux.a
RELEASE_LINUX_PLATFORM_TARGET = $(RELEASE_OUTPUT_DIR)/Linux.a

# Simple application compilation setup
SIMPLE_APPLICATION_ROOT = $(SOURCE_DIR)/Demos/SimpleApplication
SIMPLE_APPLICATION_SRC  = $(wildcard $(SIMPLE_APPLICATION_ROOT)/*.cpp)
DEBUG_SIMPLE_APPLICATION_LIBS   = -lrt $(DEBUG_LINUX_PLATFORM_TARGET)
RELEASE_SIMPLE_APPLICATION_LIBS = -lrt $(RELEASE_LINUX_PLATFORM_TARGET)
DEBUG_SIMPLE_APPLICATION_TARGET   = $(DEBUG_OUTPUT_DIR)/SimpleApplication
RELEASE_SIMPLE_APPLICATION_TARGET = $(RELEASE_OUTPUT_DIR)/SimpleApplication
SIMPLE_APPICATION_INCLUDES = -I../Source/Engine/ -I../Source/Platforms/Linux/

# Simple animation compilation setup
SIMPLE_ANIMATION_ROOT = $(SOURCE_DIR)/Demos/SimpleAnimation
SIMPLE_ANIMATION_SRC  = $(wildcard $(SIMPLE_ANIMATION_ROOT)/*.cpp)
DEBUG_SIMPLE_ANIMATION_LIBS   = -lrt $(DEBUG_LINUX_PLATFORM_TARGET)
RELEASE_SIMPLE_ANIMATION_LIBS = -lrt $(RELEASE_LINUX_PLATFORM_TARGET)
DEBUG_SIMPLE_ANIMATION_TARGET   = $(DEBUG_OUTPUT_DIR)/SimpleAnimation
RELEASE_SIMPLE_ANIMATION_TARGET = $(RELEASE_OUTPUT_DIR)/SimpleAnimation
SIMPLE_ANIMATION_INCLUDES = -I../Source/Engine/ -I../Source/Platforms/Linux/

DEBUG_OPTIMIZE   = -O0
RELEASE_OPTIMIZE = -O3
DEBUG_CFLAGS     = -Wall $(DEBUG_OPTIMIZE) -frtti -std=c++0x -pthread -ggdb
RELEASE_CFLAGS   = -Wall $(RELEASE_OPTIMIZE) -frtti -std=c++0x -pthread

CXX = g++

$(DEBUG_EXPORTER_TARGET): $(EXPORTER_SRC) $(DEBUG_ENGINE_TARGET)
	$(CXX) $(DEBUG_CFLAGS) $(EXPORTER_SRC) $(DEBUG_EXPORTER_LIBS) -o $(DEBUG_EXPORTER_TARGET)

$(RELEASE_EXPORTER_TARGET): $(EXPORTER_SRC) $(RELEASE_ENGINE_TARGET)
	$(CXX) $(RELEASE_CFLAGS) $(EXPORTER_SRC) $(RELEASE_EXPORTER_LIBS) -o $(RELEASE_EXPORTER_TARGET)

$(DEBUG_SIMPLE_APPLICATION_TARGET): $(SIMPLE_APPLICATION_SRC) $(DEBUG_ENGINE_TARGET) $(DEBUG_LINUX_PLATFORM_TARGET)
	$(CXX) $(DEBUG_CFLAGS) $(SIMPLE_APPICATION_INCLUDES) $(SIMPLE_APPLICATION_SRC) $(DEBUG_SIMPLE_APPLICATION_LIBS) -o $(DEBUG_SIMPLE_APPLICATION_TARGET)

$(RELEASE_SIMPLE_APPLICATION_TARGET): $(SIMPLE_APPLICATION_SRC) $(RELEASE_ENGINE_TARGET) $(RELEASE_LINUX_PLATFORM_TARGET)
	$(CXX) $(RELEASE_CFLAGS) $(SIMPLE_APPICATION_INCLUDES) $(SIMPLE_APPLICATION_SRC) $(RELEASE_SIMPLE_APPLICATION_LIBS) -o $(RELEASE_SIMPLE_APPLICATION_TARGET)

$(DEBUG_SIMPLE_ANIMATION_TARGET): $(SIMPLE_ANIMATION_SRC) $(DEBUG_ENGINE_TARGET) $(DEBUG_LINUX_PLATFORM_TARGET)
	$(CXX) $(DEBUG_CFLAGS) $(SIMPLE_ANIMATION_INCLUDES) $(SIMPLE_ANIMATION_SRC) $(DEBUG_SIMPLE_ANIMATION_LIBS) -o $(DEBUG_SIMPLE_ANIMATION_TARGET)

$(RELEASE_SIMPLE_ANIMATION_TARGET): $(SIMPLE_ANIMATION_SRC) $(RELEASE_ENGINE_TARGET) $(RELEASE_LINUX_PLATFORM_TARGET)
	$(CXX) $(RELEASE_CFLAGS) $(SIMPLE_ANIMATION_INCLUDES) $(SIMPLE_ANIMATION_SRC) $(RELEASE_SIMPLE_ANIMATION_LIBS) -o $(RELEASE_SIMPLE_ANIMATION_TARGET)

$(DEBUG_ENGINE_TARGET): $(DEBUG_ENGINE_OBJ)
	@ar rvs $(DEBUG_ENGINE_TARGET) $(DEBUG_ENGINE_OBJ)

$(RELEASE_ENGINE_TARGET): $(RELEASE_ENGINE_OBJ)
	@ar rvs $(RELEASE_ENGINE_TARGET) $(RELEASE_ENGINE_OBJ)

$(DEBUG_LINUX_PLATFORM_TARGET): $(DEBUG_LINUX_PLATFORM_OBJ) $(DEBUG_ENGINE_TARGET)
	@ar rvs $(DEBUG_LINUX_PLATFORM_TARGET) $(DEBUG_LINUX_PLATFORM_OBJ) $(DEBUG_ENGINE_OBJ)

$(RELEASE_LINUX_PLATFORM_TARGET): $(RELEASE_LINUX_PLATFORM_OBJ) $(RELEASE_ENGINE_TARGET)
	@ar rvs $(RELEASE_LINUX_PLATFORM_TARGET) $(RELEASE_LINUX_PLATFORM_OBJ) $(RELEASE_ENGINE_OBJ)

Debug: $(DEBUG_ENGINE_TARGET) $(DEBUG_LINUX_PLATFORM_TARGET) $(DEBUG_EXPORTER_TARGET) $(DEBUG_SIMPLE_APPLICATION_TARGET) $(DEBUG_SIMPLE_ANIMATION_TARGET)

Release: $(RELEASE_ENGINE_TARGET) $(RELEASE_LINUX_PLATFORM_TARGET) $(RELEASE_EXPORTER_TARGET) $(RELEASE_SIMPLE_APPLICATION_TARGET) $(RELEASE_SIMPLE_ANIMATION_TARGET)

cleanDebug:
	@rm -f $(DEBUG_OUTPUT_DIR)/*.*

cleanRelease:
	@rm -f $(RELEASE_OUTPUT_DIR)/*.*

clean: cleanDebug cleanRelease

all: Debug Release

.SECONDEXPANSION:
$(DEBUG_ENGINE_OBJ): $$(addprefix $(SOURCE_DIR)/,$$(subst !cpp,.cpp, $$(subst .,/, $$(patsubst $(DEBUG_OUTPUT_DIR)/%.o, %!cpp, $$@))))
	@mkdir -p $(DEBUG_OUTPUT_DIR)
	@echo "Compiling $(patsubst $(SOURCE_DIR)/%,%, $?)"
	@$(CXX) $(DEBUG_CFLAGS) $? $(DEBUG_ENGINE_LIBS) -c -o $@

$(RELEASE_ENGINE_OBJ): $$(addprefix $(SOURCE_DIR)/,$$(subst !cpp,.cpp, $$(subst .,/, $$(patsubst $(RELEASE_OUTPUT_DIR)/%.o, %!cpp, $$@))))
	@mkdir -p $(RELEASE_OUTPUT_DIR)
	@echo "Compiling $(patsubst $(SOURCE_DIR)/%,%, $?)"
	@$(CXX) $(RELEASE_CFLAGS) $? $(RELEASE_ENGINE_LIBS) -c -o $@

$(DEBUG_LINUX_PLATFORM_OBJ): $$(addprefix $(SOURCE_DIR)/,$$(subst !cpp,.cpp, $$(subst .,/, $$(patsubst $(DEBUG_OUTPUT_DIR)/%.o, %!cpp, $$@))))
	@mkdir -p $(DEBUG_OUTPUT_DIR)
	@echo "Compiling $(patsubst $(SOURCE_DIR)/%,%, $?)"
	@$(CXX) $(DEBUG_CFLAGS) $? $(DEBUG_LINUX_PLATFORM_LIBS) -c -o $@

$(RELEASE_LINUX_PLATFORM_OBJ): $$(addprefix $(SOURCE_DIR)/,$$(subst !cpp,.cpp, $$(subst .,/, $$(patsubst $(RELEASE_OUTPUT_DIR)/%.o, %!cpp, $$@))))
	@mkdir -p $(RELEASE_OUTPUT_DIR)
	@echo "Compiling $(patsubst $(SOURCE_DIR)/%,%, $?)"
	@$(CXX) $(RELEASE_CFLAGS) $? $(RELEASE_LINUX_PLATFORM_LIBS) -c -o $@
